<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Login Fix Test - NeuroSense360</title>
    <style>
        body { 
            font-family: system-ui, -apple-system, sans-serif; 
            margin: 0; 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            background: rgba(255,255,255,0.1); 
            padding: 30px; 
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        .alert { 
            padding: 15px; 
            border-radius: 8px; 
            margin: 15px 0; 
            font-weight: bold;
        }
        .alert-success { background: rgba(76, 175, 80, 0.3); border: 1px solid #4CAF50; }
        .alert-error { background: rgba(244, 67, 54, 0.3); border: 1px solid #f44336; }
        .alert-info { background: rgba(33, 150, 243, 0.3); border: 1px solid #2196F3; }
        .btn { 
            background: #2196F3; 
            color: white; 
            padding: 12px 24px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            margin: 5px; 
            font-size: 16px;
            transition: all 0.3s ease;
        }
        .btn:hover { background: #1976D2; transform: translateY(-2px); }
        .btn-success { background: #4CAF50; }
        .btn-success:hover { background: #45a049; }
        .btn-danger { background: #f44336; }
        .btn-danger:hover { background: #d32f2f; }
        .debug-log { 
            background: rgba(0,0,0,0.4); 
            padding: 20px; 
            border-radius: 8px; 
            font-family: 'Courier New', monospace; 
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
            white-space: pre-wrap;
        }
        .credentials-box {
            background: rgba(255,255,255,0.15);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .step-box {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #2196F3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß NeuroSense360 Login Fix Test</h1>
        <p>Enhanced debugging tool to fix the "invalid error" issue</p>
        
        <div class="alert alert-info">
            <strong>üéØ Goal:</strong> Identify and fix the exact cause of the login "invalid error"
        </div>

        <div class="credentials-box">
            <h3>‚úÖ Test Credentials:</h3>
            <div><strong>Super Admin:</strong> admin@neurosense360.com / admin123</div>
            <div><strong>Clinic Admin:</strong> clinic@demo.com / clinic123</div>
            <div><strong>User:</strong> user@demo.com / user123</div>
        </div>

        <div class="step-box">
            <h3>üîç Step-by-Step Fix Process:</h3>
            <button class="btn btn-success" onclick="step1()">Step 1: Clear All Storage</button>
            <button class="btn" onclick="step2()">Step 2: Test Auth Service</button>
            <button class="btn" onclick="step3()">Step 3: Open Real App</button>
            <button class="btn" onclick="step4()">Step 4: Check Console</button>
        </div>

        <div id="status" class="alert" style="display: none;"></div>
        <div id="debugLog" class="debug-log" style="display: none;"></div>
    </div>

    <script>
        let logArea = document.getElementById('debugLog');
        let statusArea = document.getElementById('status');
        
        function showStatus(message, type = 'info') {
            statusArea.style.display = 'block';
            statusArea.className = `alert alert-${type}`;
            statusArea.innerHTML = message;
        }
        
        function log(message) {
            logArea.style.display = 'block';
            const timestamp = new Date().toLocaleTimeString();
            logArea.textContent += `[${timestamp}] ${message}\n`;
            logArea.scrollTop = logArea.scrollHeight;
            console.log(message);
        }
        
        function step1() {
            log('üßπ Step 1: Clearing all storage...');
            
            // Clear all possible storage locations
            localStorage.clear();
            sessionStorage.clear();
            
            // Clear cookies (basic attempt)
            document.cookie.split(";").forEach(function(c) { 
                document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); 
            });
            
            log('‚úÖ Storage cleared successfully');
            showStatus('‚úÖ Step 1 Complete: All storage cleared', 'success');
        }
        
        function step2() {
            log('üß™ Step 2: Testing authentication service...');
            
            // Test the exact same logic as authService
            const testCredentials = {
                'admin@neurosense360.com': { 
                    password: 'admin123', 
                    user: {
                        id: 'admin-1',
                        name: 'Super Admin',
                        email: 'admin@neurosense360.com',
                        role: 'super_admin'
                    }
                },
                'clinic@demo.com': { 
                    password: 'clinic123', 
                    user: {
                        id: 'clinic-1',
                        name: 'Demo Clinic Admin',
                        email: 'clinic@demo.com',
                        role: 'clinic_admin'
                    }
                },
                'user@demo.com': { 
                    password: 'user123',
                    user: {
                        id: 'user-1',
                        name: 'Demo User',
                        email: 'user@demo.com',
                        role: 'user'
                    }
                }
            };
            
            // Test each credential
            let allPass = true;
            for (const [email, cred] of Object.entries(testCredentials)) {
                const normalizedEmail = email.trim().toLowerCase();
                
                if (testCredentials[normalizedEmail]) {
                    log(`‚úÖ ${email} - Credential found`);
                    
                    // Store successful login simulation
                    localStorage.setItem('demoUser', JSON.stringify(cred.user));
                    localStorage.setItem('demoToken', `test_token_${Date.now()}`);
                    
                } else {
                    log(`‚ùå ${email} - Credential NOT found`);
                    allPass = false;
                }
            }
            
            if (allPass) {
                log('‚úÖ All credential tests passed!');
                showStatus('‚úÖ Step 2 Complete: Auth service test passed', 'success');
            } else {
                log('‚ùå Some credential tests failed!');
                showStatus('‚ùå Step 2 Failed: Check debug log', 'error');
            }
        }
        
        function step3() {
            log('üöÄ Step 3: Opening real application...');
            showStatus('üöÄ Step 3: Opening app - try login with admin@neurosense360.com / admin123', 'info');
            window.open('http://localhost:3000/login', '_blank');
        }
        
        function step4() {
            log('üëÅÔ∏è Step 4: Console debugging instructions...');
            
            const instructions = `
üìã Console Debugging Checklist:

1. Open browser console (F12)
2. Try logging in with: admin@neurosense360.com / admin123
3. Look for these specific messages:

‚úÖ GOOD MESSAGES (login working):
   üî• LoginForm: Form submitted with data
   üöÄ AuthContext: Starting login process
   üìß Normalized email: admin@neurosense360.com
   üìù Static credential found: true
   ‚úÖ Password match - proceeding with login
   üì¶ Auth response: {success: true, token: ...}
   ‚úÖ AuthContext: Login completed successfully

‚ùå BAD MESSAGES (find these errors):
   üö® Login error: [error message]
   ‚ùå AuthContext: Invalid response format
   üö® AuthContext: Login failed
   
4. Copy ANY red error messages you see
5. If you see "invalid error" - that's our target to fix!

üí° The error might be in:
   - Form validation
   - AuthContext response handling  
   - AuthService credential matching
`;
            
            log(instructions);
            showStatus('üëÅÔ∏è Step 4: Check console while logging in', 'info');
        }
        
        // Auto-run Step 1 on page load
        window.onload = function() {
            log('üöÄ Login Fix Test initialized');
            log('üìã Ready to debug login issues step by step');
        };
    </script>
</body>
</html>